<section class="min-h-screen flex flex-col lg:flex-row relative bg-gray-50">
	<div
		*ngIf="menuOpen && isMobile"
		class="fixed inset-0 bg-black/40 backdrop-blur-sm z-40 transition-opacity cursor-pointer"
		(click)="menuOpen = false"
		(keydown.escape)="menuOpen = false"
		tabindex="0"
		role="button"
		aria-label="Cerrar menú"
	></div>

	<aside
		class="w-64 bg-gradient-to-b from-gray-900 to-gray-800 text-gray-200 flex flex-col z-50 overflow-y-auto transform transition-transform duration-300 shadow-xl fixed inset-y-0 h-screen lg:sticky lg:top-0 lg:h-auto lg:max-h-screen"
		[ngClass]="{ '-translate-x-full': !menuOpen && isMobile }"
	>
		<header class="flex items-center justify-between px-4 py-5 border-b border-gray-700">
			<div class="flex items-center gap-2">
				<img src="assets/img/arbolito.png" class="w-10 h-10" alt="Logo El Arbolito" />
				<span class="text-xl font-semibold text-white">El Arbolito</span>
			</div>
			<button class="lg:hidden text-gray-400 text-xl" (click)="menuOpen = false">
				<i class="pi pi-times"></i>
			</button>
		</header>

		<nav class="flex-1 overflow-y-auto p-2 h-[calc(100vh-80px)]">
			<ul class="space-y-1">
				<!--
          *** ¡CORRECCIÓN AQUÍ! (Línea 28) ***
          1. Se usa <ng-container> para el bucle *ngFor.
          2. Se usa *ngIf (en lugar de [ngIf]) en el <li> para la condición.
        -->
				<ng-container *ngFor="let item of menuItems">
					<li *ngIf="hasAccess(item.roles)">
						<a
							[routerLink]="item.link"
							routerLinkActive="bg-emerald-600 text-white font-semibold"
							(click)="onMenuClick()"
							class="group flex items-center gap-3 px-4 py-2.5 rounded-md transition-colors duration-200 hover:bg-gray-700 text-gray-300"
						>
							<i [class]="item.icon + ' text-gray-400 group-hover:text-white transition-colors duration-200'"></i>
							<span class="transition-colors duration-200">{{ item.label }}</span>
						</a>
					</li>
				</ng-container>
			</ul>
		</nav>
	</aside>
	<section class="flex-1 flex flex-col min-h-screen">
		<header
			class="bg-white/80 backdrop-blur-lg text-black px-6 py-4 flex justify-between items-center shadow-sm sticky top-0 z-30 border-b border-gray-200"
		>
			<div class="flex items-center gap-4">
				<button class="lg:hidden bg-gray-200 p-2 rounded-md" (click)="menuOpen = !menuOpen">
					<i class="pi pi-bars text-gray-800 text-lg"></i>
				</button>
				<h2 class="text-xl font-bold text-gray-800">Gestión de Cobros "El Arbolito"</h2>
			</div>

			<div class="flex items-center gap-2 relative">
				<button type="button" (click)="op.toggle($event)">
					<p-avatar
						[label]="currentUser.charAt(0).toUpperCase()"
						styleClass="bg-emerald-500 text-white"
						size="large"
						shape="circle"
					>
					</p-avatar>
				</button>

				<p-popover #op>
					<div class="text-sm space-y-2 w-48">
						<div class="text-center">
							<div class="font-bold text-gray-800">{{ currentUser }}</div>
							<div class="text-xs text-emerald-600 bg-emerald-100 px-2 py-0.5 rounded-full inline-block mt-1">
								<!-- Se usa el pipe 'titlecase' que importamos en el .ts -->
								{{ currentRole | titlecase }}
							</div>
						</div>
						<hr />
						<button
							(click)="logout()"
							class="w-full text-red-600 hover:underline text-sm flex items-center gap-2 justify-center"
						>
							<i class="pi pi-sign-out"></i> Cerrar sesión
						</button>
					</div>
				</p-popover>
			</div>
		</header>

		<main class="flex-1 p-6 overflow-y-auto">
			<router-outlet></router-outlet>
		</main>

		<!-- El selector 'amc-footer' debe coincidir con el de FooterComponent -->
		<amc-footer></amc-footer>
	</section>
</section>
