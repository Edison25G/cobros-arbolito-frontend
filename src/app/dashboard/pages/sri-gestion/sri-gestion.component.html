<p-toast></p-toast>

<div class="p-2 sm:p-6 animate-fade-in min-h-[85vh]">
	<div class="flex justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm border border-gray-100">
		<div>
			<h2 class="text-2xl font-extrabold text-gray-800 m-0">Gestión Electrónica SRI</h2>
			<p class="text-sm text-gray-500">Autorización de comprobantes generados</p>
		</div>
		<p-button icon="pi pi-refresh" (onClick)="cargarPendientes()" [text]="true" [rounded]="true"></p-button>
	</div>

	<div class="card bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
		<p-table
			[value]="comprobantes"
			[loading]="loading"
			styleClass="p-datatable-sm p-datatable-striped"
			[paginator]="true"
			[rows]="10"
		>
			<ng-template pTemplate="header">
				<tr class="bg-gray-50 text-xs uppercase tracking-wider text-gray-600">
					<th>Número</th>
					<th>Socio / Cliente</th>
					<th>Fecha Emisión</th>
					<th class="text-right">Total</th>
					<th class="text-center">Estado SRI</th>
					<th class="text-center">Acciones</th>
				</tr>
			</ng-template>

			<ng-template pTemplate="body" let-item>
				<tr>
					<td class="font-mono text-xs">{{ item.numero }}</td>
					<td>
						<div class="font-bold text-gray-700">{{ item.socio_nombre }}</div>
						<div
							*ngIf="item.mensaje_error"
							class="text-[10px] text-red-500 mt-1 max-w-xs truncate"
							[pTooltip]="item.mensaje_error"
						>
							<i class="pi pi-exclamation-circle"></i> {{ item.mensaje_error }}
						</div>
					</td>
					<td>{{ item.fecha_emision | date: 'dd/MM/yyyy' }}</td>
					<td class="text-right font-bold">{{ item.total | currency }}</td>

					<td class="text-center">
						<p-tag [value]="item.estado_sri" [severity]="getSeverity(item.estado_sri)"></p-tag>
					</td>

					<td class="text-center">
						<p-button
							*ngIf="item.estado_sri !== 'AUTORIZADO'"
							icon="pi pi-send"
							label="Enviar"
							styleClass="p-button-sm p-button-outlined"
							[loading]="procesandoId === item.id"
							(onClick)="procesarSRI(item)"
						>
						</p-button>

						<a
							*ngIf="item.estado_sri === 'AUTORIZADO'"
							class="text-blue-600 hover:text-blue-800 text-sm font-bold cursor-pointer"
							target="_blank"
						>
							<i class="pi pi-download"></i> PDF
						</a>
					</td>
				</tr>
			</ng-template>

			<ng-template pTemplate="emptymessage">
				<tr>
					<td colspan="6" class="text-center p-8 text-gray-400">
						<i class="pi pi-check-circle text-4xl text-green-200 mb-2"></i>
						<p>No hay facturas pendientes de envío al SRI.</p>
					</td>
				</tr>
			</ng-template>
		</p-table>
	</div>
</div>
