<p-toast></p-toast>

<div class="card p-5 bg-white rounded-xl shadow-sm border border-gray-100 animate-fade-in">
	<div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4 border-b pb-4">
		<div *ngIf="minga">
			<div class="flex items-center gap-2">
				<p-button pButton icon="pi pi-arrow-left" [text]="true" [rounded]="true" (click)="cancelar()"></p-button>
				<h2 class="text-2xl font-bold text-gray-800">{{ minga.titulo }}</h2>
			</div>
			<div class="ml-12 text-sm text-gray-500 flex gap-4">
				<span><i class="pi pi-calendar mr-1"></i> {{ minga.fecha | date: 'dd/MM/yyyy' }}</span>
				<span class="text-red-600 font-bold"
					><i class="pi pi-dollar mr-1"></i> Multa: {{ minga.multa | currency }}</span
				>
			</div>
		</div>
		<div class="flex gap-2">
			<p-button
				label="Todos Presentes"
				icon="pi pi-check-circle"
				size="small"
				[outlined]="true"
				severity="success"
				(onClick)="marcarTodos('Presente')"
			></p-button>
			<p-button label="Guardar Lista" icon="pi pi-save" size="small" (onClick)="guardar()"></p-button>
		</div>
	</div>

	<p-table
		[value]="asistenciaList"
		[loading]="loading"
		[rowHover]="true"
		styleClass="p-datatable-sm"
		[globalFilterFields]="['nombres', 'cedula']"
		#dt
	>
		<ng-template pTemplate="caption">
			<p-iconfield class="w-full sm:w-80">
				<p-inputicon styleClass="pi pi-search" />
				<input
					pInputText
					type="text"
					(input)="dt.filterGlobal($any($event.target).value, 'contains')"
					placeholder="Buscar socio..."
					class="w-full"
				/>
			</p-iconfield>
		</ng-template>

		<ng-template pTemplate="header">
			<tr>
				<th style="width: 30%">Socio</th>
				<th style="width: 40%" class="text-center">Asistencia</th>
				<th style="width: 30%">Observaci√≥n</th>
			</tr>
		</ng-template>

		<ng-template pTemplate="body" let-item>
			<tr [ngClass]="{ 'bg-red-50': item.estado === 'Falta', 'bg-green-50': item.estado === 'Presente' }">
				<td>
					<div class="font-bold">{{ item.nombres }}</div>
					<div class="text-xs text-gray-500">{{ item.cedula }}</div>
				</td>
				<td class="text-center">
					<div class="flex justify-center gap-2">
						<button
							type="button"
							*ngFor="let est of estados"
							class="px-3 py-2 rounded-lg border flex items-center gap-1 transition-all duration-200 outline-none focus:ring-2 focus:ring-offset-1"
							[ngClass]="
								item.estado === est.value
									? est.class + ' shadow-md ring-1 ring-offset-1'
									: 'bg-white text-gray-400 border-gray-200 opacity-60 hover:opacity-100'
							"
							(click)="item.estado = est.value"
						>
							<i [class]="est.icon"></i>
							<span class="text-xs font-bold hidden sm:inline">{{ est.label }}</span>
						</button>
					</div>
				</td>
				<td>
					<input
						pInputText
						[(ngModel)]="item.observacion"
						class="w-full p-inputtext-sm"
						placeholder="Nota opcional..."
					/>
				</td>
			</tr>
		</ng-template>
	</p-table>
</div>
