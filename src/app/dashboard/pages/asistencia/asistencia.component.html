<p-toast></p-toast>

<div class="card bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden animate-fade-in">
	<div class="bg-gray-50/50 p-6 border-b border-gray-100">
		<div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
			<div *ngIf="minga" class="flex-1">
				<div class="flex items-center gap-3 mb-2">
					<button
						(click)="cancelar()"
						class="p-2 rounded-full hover:bg-white hover:shadow-sm text-gray-500 transition-all duration-200"
					>
						<i class="pi pi-arrow-left text-lg"></i>
					</button>
				</div>
			</div>

			<div class="flex items-center gap-3 w-full md:w-auto">
				<p-button
					label="Todos Presentes"
					icon="pi pi-check-circle"
					[outlined]="true"
					severity="success"
					styleClass="w-full md:w-auto"
					(onClick)="marcarTodos('PRESENTE')"
				>
				</p-button>
				<p-button
					label="Guardar Lista"
					icon="pi pi-save"
					severity="primary"
					styleClass="w-full md:w-auto shadow-md shadow-blue-200"
					(onClick)="guardar()"
				>
				</p-button>
			</div>
		</div>
	</div>

	<div class="p-4">
		<p-table
			[value]="asistenciaList"
			[loading]="loading"
			[rowHover]="true"
			styleClass="p-datatable-striped"
			[globalFilterFields]="['nombres', 'identificacion']"
			#dt
		>
			<ng-template pTemplate="caption">
				<div class="flex justify-between items-center mb-2">
					<span class="text-gray-500 font-medium text-sm">Listado de Socios ({{ asistenciaList.length }})</span>
					<p-iconfield class="w-full sm:w-80">
						<p-inputicon styleClass="pi pi-search text-gray-400" />
						<input
							pInputText
							type="text"
							(input)="dt.filterGlobal($any($event.target).value, 'contains')"
							placeholder="Buscar por nombre o cédula..."
							class="w-full !rounded-full !bg-gray-50 !border-gray-200 focus:!bg-white focus:!border-blue-500 transition-all"
						/>
					</p-iconfield>
				</div>
			</ng-template>

			<ng-template pTemplate="header">
				<tr class="text-sm uppercase tracking-wider text-gray-500">
					<th style="width: 35%" class="!bg-white !border-b-2 !border-gray-100 py-4 pl-4">Socio</th>
					<th style="width: 35%" class="text-center !bg-white !border-b-2 !border-gray-100 py-4">
						Estado de Asistencia
					</th>
					<th style="width: 30%" class="!bg-white !border-b-2 !border-gray-100 py-4">Observación</th>
				</tr>
			</ng-template>

			<ng-template pTemplate="body" let-item>
				<tr class="transition-colors duration-200 border-b border-gray-50 hover:bg-blue-50/30">
					<td class="pl-4 py-3">
						<div class="flex items-center gap-3">
							<div>
								<div class="font-bold text-gray-800">{{ item.nombres }}</div>
								<div class="text-xs text-gray-500 flex items-center gap-1">
									<i class="pi pi-id-card text-[10px]"></i>
									{{ item.identificacion }}
								</div>
							</div>
						</div>
					</td>

					<td class="text-center py-3">
						<div class="inline-flex bg-gray-100 p-1 rounded-xl shadow-inner gap-1">
							<button
								*ngFor="let est of estados"
								type="button"
								(click)="item.estado = est.value"
								class="px-4 py-2 rounded-lg text-xs font-bold transition-all duration-200 flex items-center gap-2"
								[ngClass]="
									item.estado === est.value
										? 'bg-white text-gray-800 shadow-sm transform scale-105 ring-1 ring-black/5'
										: 'text-gray-400 hover:text-gray-600 hover:bg-gray-200/50'
								"
							>
								<i
									[class]="est.icon"
									[ngClass]="{
										'text-green-500': item.estado === est.value && est.value === 'PRESENTE',
										'text-red-500': item.estado === est.value && est.value === 'Falta',
										'text-yellow-500': item.estado === est.value && est.value === 'JUSTIFICADO',
									}"
								></i>
								<span>{{ est.label }}</span>
							</button>
						</div>

						<div class="h-1 w-full mt-2 rounded-full overflow-hidden opacity-50 max-w-[180px] mx-auto">
							<div
								class="h-full w-full transition-colors duration-300"
								[ngClass]="{
									'bg-green-400': item.estado === 'PRESENTE',
									'bg-red-400': item.estado === 'Falta',
									'bg-yellow-400': item.estado === 'JUSTIFICADO',
									'bg-transparent': !item.estado,
								}"
							></div>
						</div>
					</td>

					<td class="py-3 pr-4">
						<input
							pInputText
							[(ngModel)]="item.observacion"
							class="w-full !border-0 !border-b !border-gray-200 !rounded-none !bg-transparent focus:!border-blue-500 focus:!ring-0 px-0 text-sm text-gray-600 placeholder-gray-300 transition-colors"
							placeholder="Añadir nota..."
						/>
					</td>
				</tr>
			</ng-template>

			<ng-template pTemplate="emptymessage">
				<tr>
					<td colspan="3" class="text-center py-12">
						<div class="flex flex-col items-center justify-center text-gray-400">
							<i class="pi pi-search text-4xl mb-3 opacity-20"></i>
							<p>No se encontraron socios con ese criterio.</p>
						</div>
					</td>
				</tr>
			</ng-template>
		</p-table>
	</div>
</div>
