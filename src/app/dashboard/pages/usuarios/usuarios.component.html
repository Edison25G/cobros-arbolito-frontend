<p-toast></p-toast>
<p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>

<div class="p-2 sm:p-6 animate-fade-in min-h-[85vh]">
	<section class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
		<div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 w-full">
			<h2 class="text-2xl font-bold text-gray-800 m-0">Gesti√≥n de Personal</h2>
			<p class="text-sm text-gray-500 m-0">Control de accesos y roles del sistema (Admins, Tesoreros, Operadores)</p>
		</div>
	</section>

	<div class="rounded-2xl shadow-sm border border-gray-200 bg-white overflow-hidden">
		<p-table
			#dt
			[value]="usuarios"
			[loading]="loading"
			[paginator]="true"
			[rows]="10"
			[rowsPerPageOptions]="[5, 10, 20]"
			[globalFilterFields]="['username', 'first_name', 'last_name', 'email', 'rol']"
			dataKey="id"
			[rowHover]="true"
			currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} usuarios"
			[showCurrentPageReport]="true"
			styleClass="p-datatable-sm"
		>
			<ng-template pTemplate="caption">
				<div class="flex flex-col sm:flex-row items-center justify-between gap-3 p-4">
					<span class="text-xl font-semibold text-gray-800">Listado de Usuarios</span>
					<p-iconfield iconPosition="left" class="w-full sm:w-auto">
						<p-inputicon styleClass="pi pi-search" />
						<input
							pInputText
							type="text"
							placeholder="Buscar usuario..."
							(input)="dt.filterGlobal($any($event.target).value, 'contains')"
							class="w-full sm:w-72"
						/>
					</p-iconfield>
				</div>
			</ng-template>

			<ng-template pTemplate="header">
				<tr class="bg-gray-50 text-sm uppercase text-gray-600">
					<th pSortableColumn="username">Usuario <p-sortIcon field="username" /></th>
					<th pSortableColumn="first_name">Nombre <p-sortIcon field="first_name" /></th>
					<th pSortableColumn="rol">Rol <p-sortIcon field="rol" /></th>
					<th pSortableColumn="is_active">Estado <p-sortIcon field="is_active" /></th>
					<th class="text-center">Acciones</th>
				</tr>
			</ng-template>

			<ng-template pTemplate="body" let-user>
				<tr>
					<td>
						<span class="font-bold text-gray-800 block">{{ user.username }}</span>
						<span class="text-xs text-gray-500">{{ user.email || 'Sin correo' }}</span>
					</td>
					<td class="text-gray-700">{{ user.first_name }} {{ user.last_name }}</td>
					<td>
						<p-tag
							[value]="user.rol"
							[severity]="user.rol === 'ADMIN' ? 'danger' : user.rol === 'TESORERO' ? 'warn' : 'info'"
							[rounded]="true"
						>
						</p-tag>
					</td>
					<td>
						<p-tag
							[value]="user.is_active ? 'Activo' : 'Inactivo'"
							[severity]="user.is_active ? 'success' : 'secondary'"
							icon="{{ user.is_active ? 'pi pi-check' : 'pi pi-times' }}"
						>
						</p-tag>
					</td>
					<td class="text-center">
						<p-button
							*ngIf="user.username !== 'admin'"
							icon="pi pi-trash"
							[rounded]="true"
							[text]="true"
							severity="danger"
							pTooltip="Revocar Acceso"
							tooltipPosition="left"
							(onClick)="deleteUsuario(user)"
						>
						</p-button>
						<span *ngIf="user.username === 'admin'" class="text-xs text-gray-400 italic"> Super Admin </span>
					</td>
				</tr>
			</ng-template>

			<ng-template pTemplate="emptymessage">
				<tr>
					<td colspan="5" class="text-center p-8">
						<div class="flex flex-col items-center justify-center text-gray-500">
							<i class="pi pi-users text-4xl mb-2 text-gray-300"></i>
							<p>No se encontraron usuarios registrados.</p>
						</div>
					</td>
				</tr>
			</ng-template>
		</p-table>
	</div>
</div>
