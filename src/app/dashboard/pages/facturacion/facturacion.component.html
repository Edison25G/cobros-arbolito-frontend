<p-toast></p-toast>
<p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>

<!-- Encabezado -->
<div class="mb-6">
	<h2 class="text-3xl font-extrabold text-gray-800 tracking-tight">Generar Facturación</h2>
	<p class="text-lg text-gray-500 mt-1">Lista de lecturas pendientes por facturar. (Datos simulados)</p>
</div>

<!-- Tabla de Lecturas Pendientes -->
<div class="p-6 rounded-2xl shadow border border-gray-200 bg-white">
	<p-table
		#dt
		[value]="lecturasPendientes"
		[loading]="isLoading"
		[paginator]="true"
		[rows]="10"
		[rowsPerPageOptions]="[5, 10, 20]"
		[globalFilterFields]="['medidor.codigo', 'socio.nombres', 'socio.apellidos', 'socio.cedula']"
		dataKey="id"
		[rowHover]="true"
		currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} lecturas"
		[showCurrentPageReport]="true"
		[tableStyle]="{ 'min-width': '75rem' }"
	>
		<ng-template pTemplate="caption">
			<div class="flex items-center justify-between">
				<span class="text-xl font-semibold text-black">Lecturas Pendientes de Facturar</span>
				<p-iconfield>
					<p-inputicon styleClass="pi pi-search" />
					<input
						pInputText
						type="text"
						placeholder="Buscar por socio, cédula o medidor..."
						(input)="dt.filterGlobal($any($event.target).value, 'contains')"
						class="w-full sm:w-64 text-black"
					/>
				</p-iconfield>
			</div>
		</ng-template>

		<ng-template pTemplate="header">
			<tr>
				<th pSortableColumn="socio.apellidos">Socio <p-sortIcon field="socio.apellidos" /></th>
				<th pSortableColumn="medidor.codigo">Medidor <p-sortIcon field="medidor.codigo" /></th>
				<th pSortableColumn="fecha_lectura">Fecha Lectura <p-sortIcon field="fecha_lectura" /></th>
				<th pSortableColumn="consumo_del_mes_m3">Consumo (m³) <p-sortIcon field="consumo_del_mes_m3" /></th>
				<th>Acciones</th>
			</tr>
		</ng-template>

		<ng-template pTemplate="body" let-lectura>
			<tr>
				<td>
					<div class="font-medium text-black">{{ lectura.socio.nombres }} {{ lectura.socio.apellidos }}</div>
					<div class="text-xs text-gray-600">{{ lectura.socio.cedula }}</div>
				</td>
				<td>
					<span class="font-mono text-black p-2 bg-gray-100 rounded-md">{{ lectura.medidor.codigo }}</span>
				</td>
				<td class="text-black">{{ lectura.fecha_lectura | date: 'dd/MM/yyyy' }}</td>
				<td class="font-bold text-black text-lg">{{ lectura.consumo_del_mes_m3 }} m³</td>
				<td>
					<!--
            Este botón llama a la API REAL de tu compañero
          -->
					<p-button
						label="Generar Factura"
						icon="pi pi-file-export"
						[loading]="isGenerating"
						(click)="onGenerarFactura(lectura)"
					></p-button>
				</td>
			</tr>
		</ng-template>

		<ng-template pTemplate="emptymessage">
			<tr>
				<td colspan="5" class="text-black text-center p-4">No hay lecturas pendientes por facturar (simulación).</td>
			</tr>
		</ng-template>
	</p-table>
</div>
