<div class="flex flex-col gap-6">
	<p-card styleClass="shadow-md border-0 rounded-lg">
		<ng-template pTemplate="header">
			<div class="p-4 bg-gray-50 rounded-t-lg">
				<h2 class="text-xl font-semibold text-gray-800">Generar Facturaci칩n Mensual</h2>
				<p class="text-sm text-gray-500">Seleccione el mes y a침o para generar las facturas.</p>
			</div>
		</ng-template>

		<form
			[formGroup]="facturacionForm"
			(ngSubmit)="generarFacturacion()"
			class="flex flex-col md:flex-row items-end gap-4 p-4"
		>
			<div class="w-full md:w-auto">
				<label for="mesAnio" class="block text-sm font-medium text-gray-700 mb-1">Mes y A침o</label>
				<p-datepicker
					inputId="mesAnio"
					formControlName="mesAnio"
					view="month"
					dateFormat="mm/yy"
					[showIcon]="true"
					styleClass="w-full"
				></p-datepicker>
			</div>

			<p-button
				type="submit"
				label="Generar Facturas"
				icon="pi pi-cog"
				styleClass="p-button-success"
				[loading]="isGenerating"
				[disabled]="facturacionForm.invalid || isGenerating"
			></p-button>
		</form>
	</p-card>

	<div class="card shadow-md border-0 rounded-lg">
		<div class="flex items-center justify-between gap-4 mb-5 p-4 bg-gray-50 rounded-t-lg">
			<div>
				<h2 class="text-xl font-semibold text-gray-800">Historial de Facturas</h2>
				<p class="text-sm text-gray-500">Lista de todas las facturas generadas, pendientes y pagadas.</p>
			</div>
		</div>

		<p-table
			[value]="facturas"
			[loading]="isLoadingTable"
			[paginator]="true"
			[rows]="10"
			styleClass="p-datatable-striped"
			responsiveLayout="scroll"
		>
			<ng-template pTemplate="header">
				<tr>
					<th pSortableColumn="numeroFactura"># Factura <p-sortIcon field="numeroFactura"></p-sortIcon></th>
					<th pSortableColumn="nombreSocio">Socio <p-sortIcon field="nombreSocio"></p-sortIcon></th>
					<th pSortableColumn="fechaEmision">F. Emisi칩n <p-sortIcon field="fechaEmision"></p-sortIcon></th>
					<th pSortableColumn="total">Total <p-sortIcon field="total"></p-sortIcon></th>
					<th pSortableColumn="estado">Estado <p-sortIcon field="estado"></p-sortIcon></th>
					<th class="text-center">Acciones</th>
				</tr>
			</ng-template>

			<ng-template pTemplate="body" let-factura>
				<tr>
					<td>
						<span class="font-medium text-gray-700">{{ factura.numeroFactura }}</span>
					</td>
					<td>
						<div class="flex flex-col">
							<span class="font-medium">{{ factura.nombreSocio | titlecase }}</span>
							<span class="text-sm text-gray-600">{{ factura.cedulaSocio }}</span>
						</div>
					</td>
					<td>
						{{ factura.fechaEmision | date: 'dd/MM/yyyy' }}
					</td>
					<td>
						<div class="flex justify-center gap-2">
							<button
								pButton
								pRipple
								pTooltip="Ver Detalle"
								tooltipPosition="top"
								icon="pi pi-search"
								class="p-button-rounded p-button-text p-button-info"
							>
								<span class="sr-only">Ver Detalle</span>
							</button>

							<button
								pButton
								pRipple
								pTooltip="Registrar Pago"
								tooltipPosition="top"
								icon="pi pi-check-circle"
								class="p-button-rounded p-button-text p-button-success"
								[disabled]="factura.estado === 'Pagada'"
							>
								<span class="sr-only">Registrar Pago</span>
							</button>
						</div>
					</td>

					<td>
						<div class="flex justify-center gap-2">
							<button
								pButton
								pRipple
								pTooltip="Ver Detalle"
								tooltipPosition="top"
								icon="pi pi-search"
								class="p-button-rounded p-button-text p-button-info"
							>
								<span class="sr-only">Ver Detalle</span>
							</button>

							<button
								pButton
								pRipple
								pTooltip="Registrar Pago"
								tooltipPosition="top"
								icon="pi pi-check-circle"
								class="p-button-rounded p-button-text p-button-success"
								[disabled]="factura.estado === 'Pagada'"
							>
								<span class="sr-only">Registrar Pago</span>
							</button>
						</div>
					</td>
				</tr>
			</ng-template>

			<ng-template pTemplate="emptymessage">
				<tr>
					<td colspan="6" class="text-center">No se encontraron facturas.</td>
				</tr>
			</ng-template>
		</p-table>
	</div>
</div>
