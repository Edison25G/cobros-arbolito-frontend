<app-page-header
	title="Zonas y Barrios"
	subtitle="Organización geográfica de la Junta de Riego."
	buttonLabel="Nuevo Barrio"
	icon="pi pi-plus"
	(actionClick)="abrirModalNuevo()"
></app-page-header>

<div class="h-full flex flex-col p-4 md:p-8 bg-slate-50/50 animate-fade-in font-sans overflow-hidden">
	<div class="flex-1 overflow-y-auto pr-2 custom-scrollbar min-h-0">
		<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-8">
			<div
				*ngFor="let barrio of barrios"
				class="group relative bg-white rounded-2xl p-6 shadow-sm border border-slate-100 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer overflow-hidden focus:ring-2 focus:ring-emerald-500 focus:outline-none"
				(click)="verDetalle(barrio)"
				(keydown.enter)="verDetalle(barrio)"
				tabindex="0"
				role="button"
				[attr.aria-label]="'Ver detalles de ' + barrio.nombre"
			>
				<div
					class="absolute top-0 right-0 w-32 h-32 bg-emerald-500/5 rounded-full -mr-10 -mt-10 group-hover:bg-emerald-500/10 transition-colors duration-500"
				></div>

				<div class="flex justify-between items-start mb-5 relative z-10">
					<div
						class="w-12 h-12 rounded-xl bg-slate-50 text-emerald-600 flex items-center justify-center text-xl shadow-sm border border-slate-100 group-hover:bg-emerald-500 group-hover:text-white transition-colors duration-300"
					>
						<i class="pi pi-map-marker"></i>
					</div>

					<span
						class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide border shadow-sm transition-colors"
						[ngClass]="
							barrio.activo
								? 'bg-emerald-50 text-emerald-700 border-emerald-100'
								: 'bg-red-50 text-red-700 border-red-100'
						"
					>
						<span class="w-1.5 h-1.5 rounded-full" [ngClass]="barrio.activo ? 'bg-emerald-500' : 'bg-red-500'"></span>
						{{ barrio.activo ? 'Activo' : 'Inactivo' }}
					</span>
				</div>

				<div class="relative z-10 mb-5">
					<h3 class="text-lg font-bold text-slate-800 group-hover:text-emerald-700 transition-colors mb-1 truncate">
						{{ barrio.nombre }}
					</h3>
					<p class="text-xs text-slate-400 line-clamp-2 min-h-[2.5em] leading-relaxed">
						{{ barrio.descripcion || 'Sin descripción técnica registrada para esta zona.' }}
					</p>
				</div>

				<div class="flex items-center justify-between pt-4 border-t border-slate-50 relative z-10">
					<div class="flex flex-col">
						<span class="text-[10px] uppercase font-bold text-slate-400 tracking-wider">Socios</span>
						<span class="text-xl font-extrabold text-slate-700">{{ barrio.cantidadSocios || 0 }}</span>
					</div>

					<div
						class="flex gap-1 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-opacity duration-200"
					>
						<p-button
							icon="pi pi-pencil"
							[text]="true"
							[rounded]="true"
							severity="secondary"
							styleClass="!w-8 !h-8 !p-0 hover:!bg-amber-50 hover:!text-amber-600"
							(onClick)="editarBarrio(barrio, $event)"
							pTooltip="Editar"
							tooltipPosition="top"
						>
						</p-button>
						<p-button
							icon="pi pi-trash"
							[text]="true"
							[rounded]="true"
							severity="danger"
							styleClass="!w-8 !h-8 !p-0 hover:!bg-red-50"
							(onClick)="eliminarBarrio(barrio, $event)"
							pTooltip="Eliminar"
							tooltipPosition="top"
						>
						</p-button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div *ngIf="barrios.length === 0" class="flex-1 flex flex-col items-center justify-center animate-fade-in-up">
		<div
			class="w-24 h-24 bg-white rounded-full flex items-center justify-center shadow-sm border border-slate-100 mb-6"
		>
			<i class="pi pi-map text-4xl text-emerald-200"></i>
		</div>
		<h3 class="text-xl font-bold text-slate-800">Sin zonas registradas</h3>
		<p class="text-slate-500 text-sm mt-2 max-w-xs text-center">
			Organice su padrón electoral y de cobros creando el primer barrio.
		</p>
		<p-button
			label="Configurar primer barrio"
			[text]="true"
			styleClass="mt-4 !text-emerald-600 font-bold"
			(onClick)="abrirModalNuevo()"
		>
		</p-button>
	</div>
</div>

<p-dialog
	[(visible)]="mostrarModalCrear"
	[modal]="true"
	[draggable]="false"
	[resizable]="false"
	[style]="{ width: '450px' }"
	styleClass="p-dialog-modern"
	header=" "
>
	<ng-template pTemplate="header">
		<div class="flex items-center gap-3 w-full border-b border-slate-100 pb-4 mb-2">
			<div
				class="w-10 h-10 rounded-full bg-emerald-50 flex items-center justify-center text-emerald-600 shadow-sm border border-emerald-100"
			>
				<i class="pi" [ngClass]="esEdicion ? 'pi-pencil' : 'pi-plus'"></i>
			</div>
			<div>
				<h3 class="font-bold text-lg text-slate-800 m-0">{{ esEdicion ? 'Actualizar Zona' : 'Registrar Zona' }}</h3>
				<p class="text-xs text-slate-400 m-0 font-medium">Complete la información técnica del sector.</p>
			</div>
		</div>
	</ng-template>

	<form [formGroup]="barrioForm" (ngSubmit)="guardarBarrio()" class="flex flex-col gap-6 pt-4 px-1">
		<div class="flex flex-col gap-2">
			<label for="nombre" class="text-xs font-bold text-slate-500 uppercase tracking-widest"
				>Nombre Identificador <span class="text-red-500">*</span></label
			>
			<input
				pInputText
				id="nombre"
				formControlName="nombre"
				placeholder="Ej: Sector El Arbolito Centro"
				class="w-full !rounded-xl !border-slate-200 !py-3 focus:!border-emerald-500 focus:!ring-emerald-100 transition-all"
				[ngClass]="{ 'ng-invalid ng-dirty': barrioForm.get('nombre')?.invalid && barrioForm.get('nombre')?.touched }"
			/>
			<small
				*ngIf="barrioForm.get('nombre')?.invalid && barrioForm.get('nombre')?.touched"
				class="text-red-500 text-[10px] font-bold flex items-center gap-1 uppercase"
			>
				<i class="pi pi-exclamation-triangle"></i> El nombre es obligatorio
			</small>
		</div>

		<div class="flex flex-col gap-2">
			<label for="descripcion" class="text-xs font-bold text-slate-500 uppercase tracking-widest"
				>Descripción / Notas</label
			>
			<textarea
				pTextarea
				id="descripcion"
				formControlName="descripcion"
				rows="3"
				placeholder="Indique referencias geográficas..."
				class="w-full !rounded-xl !border-slate-200 focus:!border-emerald-500 focus:!ring-emerald-100 resize-none transition-all"
			>
			</textarea>
		</div>

		<div class="bg-slate-50 p-4 rounded-2xl border border-slate-100 flex items-center justify-between">
			<div class="flex flex-col">
				<span class="text-sm font-bold text-slate-700">Estado de Operación</span>
				<span class="text-[10px] text-slate-400 font-medium uppercase tracking-tighter"
					>Habilitar para vinculación de socios</span
				>
			</div>
			<p-toggleswitch formControlName="activo"></p-toggleswitch>
		</div>
	</form>

	<ng-template pTemplate="footer">
		<div class="flex justify-between items-center w-full pt-4 border-t border-slate-100">
			<p-button
				label="Descartar"
				[text]="true"
				severity="secondary"
				styleClass="!text-slate-500 font-bold"
				(onClick)="mostrarModalCrear = false"
			>
			</p-button>
			<p-button
				label="{{ guardando ? 'Procesando...' : 'Confirmar Guardado' }}"
				icon="pi pi-check"
				[loading]="guardando"
				[disabled]="barrioForm.invalid || guardando"
				styleClass="!bg-slate-800 !border-slate-800 hover:!bg-slate-700 !rounded-xl !px-6"
				(onClick)="guardarBarrio()"
			>
			</p-button>
		</div>
	</ng-template>
</p-dialog>
