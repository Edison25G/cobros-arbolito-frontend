<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="p-4 animate-fade-in">
	<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
		<div>
			<h2 class="text-2xl font-bold text-gray-800">Organización por Barrios</h2>
			<p class="text-sm text-gray-500">Gestione los sectores y zonas de cobro.</p>
		</div>

		<p-button
			label="Nuevo Barrio"
			icon="pi pi-plus"
			styleClass="bg-[#23A455] border-none hover:bg-[#1b8744]"
			(onClick)="abrirModalNuevo()"
		>
		</p-button>
	</div>

	<div *ngIf="loading" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
		<p-skeleton height="150px" styleClass="rounded-xl" *ngFor="let i of [1, 2, 3, 4]"></p-skeleton>
	</div>

	<div *ngIf="!loading" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
		<div
			*ngFor="let barrio of barrios"
			class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-all duration-300 cursor-pointer group relative overflow-hidden focus:ring-2 focus:ring-blue-400 focus:outline-none flex flex-col justify-between"
			(click)="verDetalle(barrio)"
			[tabindex]="0"
			(keydown.enter)="verDetalle(barrio)"
			role="button"
		>
			<div
				class="absolute top-0 right-0 w-24 h-24 bg-blue-50 rounded-full -mr-10 -mt-10 transition-transform group-hover:scale-150"
			></div>

			<div class="relative z-10">
				<div class="flex items-center justify-between mb-4">
					<div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center text-xl">
						<i class="pi pi-map-marker"></i>
					</div>
					<span class="bg-gray-100 text-gray-600 text-xs font-bold px-2 py-1 rounded-full">
						{{ barrio.cantidadSocios || 0 }} Socios
					</span>
				</div>

				<h3 class="text-lg font-bold text-gray-800 mb-1">{{ barrio.nombre }}</h3>

				<div class="flex gap-3 text-xs mt-3">
					<span *ngIf="barrio.activo" class="text-green-600 flex items-center gap-1">
						<i class="pi pi-check-circle"></i> Disponible
					</span>
					<span *ngIf="!barrio.activo" class="text-red-500 flex items-center gap-1">
						<i class="pi pi-times-circle"></i> Inactivo
					</span>
				</div>
			</div>

			<div class="relative z-20 mt-4 pt-4 border-t border-gray-100 flex justify-end gap-2">
				<p-button
					icon="pi pi-pencil"
					[rounded]="true"
					[text]="true"
					severity="info"
					pTooltip="Editar nombre"
					(onClick)="editarBarrio(barrio, $event)"
				>
				</p-button>
				<p-button
					icon="pi pi-trash"
					[rounded]="true"
					[text]="true"
					severity="danger"
					pTooltip="Desactivar barrio"
					(onClick)="eliminarBarrio(barrio, $event)"
				>
				</p-button>
			</div>
		</div>
	</div>

	<div *ngIf="!loading && barrios.length === 0" class="text-center py-10">
		<div class="flex flex-col items-center justify-center text-gray-500">
			<i class="pi pi-map text-4xl mb-2 text-gray-300"></i>
			<p class="font-medium">No se encontraron barrios registrados.</p>
			<p class="text-sm mt-1 text-gray-400">¡Crea el primero usando el botón de arriba!</p>
		</div>
	</div>
</div>

<p-dialog
	[header]="esEdicion ? 'Editar Barrio' : 'Registrar Nuevo Barrio'"
	[(visible)]="mostrarModalCrear"
	[modal]="true"
	[style]="{ width: '450px' }"
	[draggable]="false"
	[resizable]="false"
	class="p-fluid"
>
	<form [formGroup]="barrioForm" (ngSubmit)="guardarBarrio()" class="flex flex-col gap-4 mt-2">
		<div class="flex flex-col gap-2">
			<label for="nombre" class="font-bold text-gray-700">Nombre del Barrio <span class="text-red-500">*</span></label>
			<input pInputText id="nombre" formControlName="nombre" placeholder="Ej: San Sebastián" />

			<small
				*ngIf="barrioForm.get('nombre')?.invalid && barrioForm.get('nombre')?.touched"
				class="text-red-500 flex items-center gap-1"
			>
				<i class="pi pi-exclamation-circle"></i> El nombre es obligatorio.
			</small>
		</div>

		<div class="flex flex-col gap-2">
			<label for="descripcion" class="font-bold text-gray-700">Descripción (Opcional)</label>
			<textarea
				pTextarea
				id="descripcion"
				formControlName="descripcion"
				rows="3"
				placeholder="Detalles adicionales..."
				class="w-full resize-none"
			>
			</textarea>
		</div>

		<div class="flex items-center gap-3 mt-2 bg-gray-50 p-3 rounded-lg border border-gray-100">
			<p-toggleswitch formControlName="activo" inputId="activoSwitch"></p-toggleswitch>
			<label for="activoSwitch" class="text-gray-700 cursor-pointer select-none">¿Barrio Activo?</label>
		</div>

		<div class="flex justify-end gap-2 mt-6 pt-4 border-t border-gray-100">
			<p-button
				label="Cancelar"
				icon="pi pi-times"
				[text]="true"
				severity="secondary"
				(onClick)="mostrarModalCrear = false"
			>
			</p-button>
			<p-button label="Guardar" icon="pi pi-check" type="submit" [loading]="guardando" [disabled]="barrioForm.invalid">
			</p-button>
		</div>
	</form>
</p-dialog>
