<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="animate-fade-in p-4 h-full flex flex-col font-sans bg-slate-50/50 overflow-hidden">
	<div class="flex-none mb-4 flex justify-between items-center">
		<div>
			<h2 class="text-2xl font-extrabold text-slate-800 tracking-tight flex items-center gap-2">
				<i class="pi pi-chart-pie text-emerald-500"></i> Mi Medidor
			</h2>
			<p class="text-slate-500 text-xs">Monitoreo en tiempo real.</p>
		</div>

		<span
			class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold bg-white border border-slate-200 shadow-sm text-slate-600"
		>
			<span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span> ONLINE
		</span>
	</div>

	<div *ngIf="isLoading" class="flex-1 grid grid-cols-1 lg:grid-cols-3 gap-4 animate-pulse min-h-0">
		<div class="lg:col-span-1 bg-slate-200 rounded-2xl h-full"></div>
		<div class="lg:col-span-2 bg-slate-200 rounded-2xl h-full"></div>
	</div>

	<div *ngIf="!isLoading && medidor" class="flex-1 grid grid-cols-1 lg:grid-cols-3 gap-4 min-h-0">
		<div class="lg:col-span-1 h-full flex flex-col">
			<div class="bg-white rounded-2xl shadow-lg border border-slate-100 h-full flex flex-col overflow-hidden group">
				<div
					class="flex-1 bg-gradient-to-br from-slate-800 to-slate-900 p-6 text-white relative flex flex-col justify-between overflow-hidden"
				>
					<div
						class="absolute top-0 right-0 w-32 h-32 bg-emerald-500/20 rounded-full blur-2xl -mr-10 -mt-10 pointer-events-none"
					></div>
					<div
						class="absolute bottom-0 left-0 w-24 h-24 bg-blue-500/10 rounded-full blur-2xl -ml-5 -mb-5 pointer-events-none"
					></div>

					<div class="flex justify-between items-start relative z-10">
						<span class="text-[10px] uppercase tracking-widest text-slate-400 font-bold">Smart Meter</span>
						<i class="pi pi-wifi text-emerald-400 animate-pulse"></i>
					</div>

					<div class="relative z-10 text-center my-auto">
						<div class="text-[9px] text-slate-400 mb-1 font-mono">SERIAL ID</div>
						<div
							class="text-3xl font-mono font-bold tracking-widest text-emerald-300 drop-shadow-[0_0_8px_rgba(16,185,129,0.5)]"
						>
							{{ medidor.codigo }}
						</div>
					</div>

					<div class="relative z-10 flex justify-between items-end">
						<div class="flex items-center gap-1.5">
							<div
								class="w-1.5 h-1.5 rounded-full"
								[ngClass]="medidor.estado === 'ACTIVO' ? 'bg-emerald-400 shadow-[0_0_5px_#34d399]' : 'bg-red-500'"
							></div>
							<span class="text-[10px] font-bold tracking-wide">{{ medidor.estado }}</span>
						</div>
					</div>
				</div>

				<div class="p-5 bg-white flex-none">
					<div class="space-y-4">
						<div class="flex items-center gap-3">
							<div class="w-8 h-8 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center">
								<i class="pi pi-map-marker"></i>
							</div>
							<div>
								<span class="block text-[10px] font-bold text-slate-400 uppercase">Ubicación</span>
								<span class="text-sm font-semibold text-slate-800 leading-tight block truncate">{{
									medidor.nombre_barrio
								}}</span>
							</div>
						</div>

						<div class="grid grid-cols-2 gap-2">
							<div class="bg-slate-50 p-2 rounded-lg border border-slate-100">
								<span class="block text-[9px] font-bold text-slate-400 uppercase">Marca</span>
								<span class="text-xs font-semibold text-slate-700">{{ medidor.marca || 'Genérico' }}</span>
							</div>
							<div class="bg-slate-50 p-2 rounded-lg border border-slate-100">
								<span class="block text-[9px] font-bold text-slate-400 uppercase">Año</span>
								<span class="text-xs font-semibold text-slate-700">2025</span>
							</div>
						</div>

						<div class="pt-3 border-t border-slate-50 flex justify-between items-center">
							<span class="text-xs font-bold text-slate-500">Lectura Inicial</span>
							<span class="text-lg font-extrabold text-slate-800">
								{{ medidor.lectura_inicial }} <span class="text-xs text-slate-400 font-normal">m³</span>
							</span>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="lg:col-span-2 h-full flex flex-col">
			<div
				class="bg-white rounded-2xl shadow-sm border border-slate-200 h-full p-5 flex flex-col relative overflow-hidden"
			>
				<div class="flex-none flex justify-between items-start mb-2 relative z-10">
					<div>
						<h3 class="text-lg font-bold text-slate-800">Tendencia</h3>
						<p class="text-xs text-slate-500">Últimos 6 meses.</p>
					</div>

					<div class="hidden sm:flex flex-col items-end bg-slate-50 px-3 py-1 rounded-lg border border-slate-100">
						<span class="text-[10px] font-bold text-slate-400 uppercase">Promedio</span>
						<div class="flex items-baseline gap-1">
							<span class="text-xl font-extrabold text-blue-600">{{ promedioConsumo || '0' }}</span>
							<span class="text-xs text-slate-500 font-medium">m³</span>
						</div>
					</div>
				</div>

				<div *ngIf="historial.length > 0" class="flex-1 w-full min-h-0 relative z-10">
					<p-chart type="line" [data]="chartData" [options]="chartOptions" height="100%" width="100%"></p-chart>
				</div>

				<div *ngIf="historial.length === 0" class="flex-1 flex flex-col items-center justify-center relative z-10">
					<div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mb-3">
						<i class="pi pi-chart-line text-2xl text-slate-300"></i>
					</div>
					<p class="text-xs text-slate-400">Insuficientes datos para graficar.</p>
				</div>

				<div
					*ngIf="historial.length > 0"
					class="flex-none mt-2 pt-2 border-t border-slate-50 text-xs text-slate-500 flex items-center gap-2"
				>
					<i class="pi pi-check-circle text-emerald-500"></i>
					<span>Consumo dentro del rango normal.</span>
				</div>
			</div>
		</div>
	</div>

	<div *ngIf="!isLoading && !medidor" class="flex-1 flex flex-col items-center justify-center">
		<i class="pi pi-exclamation-circle text-4xl text-amber-400 mb-2"></i>
		<h3 class="text-lg font-bold text-slate-800">Sin Medidor</h3>
		<p class="text-sm text-slate-500">No hay dispositivo asignado.</p>
	</div>
</div>
