<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="mb-4 animate-fade-in">
	<h2 class="text-2xl font-extrabold text-gray-800 tracking-tight">Mi Medidor</h2>
	<p class="text-sm text-gray-500">Información técnica y estadísticas de tu consumo.</p>
</div>

<div *ngIf="isLoading" class="grid grid-cols-1 lg:grid-cols-3 gap-4 animate-pulse">
	<div class="lg:col-span-1">
		<div class="bg-white p-4 rounded-xl shadow border border-gray-200 h-full">
			<p-skeleton width="50%" height="2rem" styleClass="mb-4"></p-skeleton>
			<p-skeleton width="100%" height="15rem"></p-skeleton>
		</div>
	</div>
	<div class="lg:col-span-2">
		<div class="bg-white p-4 rounded-xl shadow border border-gray-200 h-full">
			<p-skeleton width="40%" height="2rem" styleClass="mb-4"></p-skeleton>
			<p-skeleton width="100%" height="20rem"></p-skeleton>
		</div>
	</div>
</div>

<div *ngIf="!isLoading && medidor" class="grid grid-cols-1 lg:grid-cols-3 gap-4 animate-fade-in items-start">
	<div class="lg:col-span-1">
		<div
			class="bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden hover:shadow-lg transition-shadow duration-300"
		>
			<div class="bg-blue-600 p-4 text-white relative overflow-hidden">
				<i class="pi pi-tint absolute -right-4 -bottom-4 text-8xl text-blue-500 opacity-30"></i>
				<div class="flex justify-between items-start relative z-10">
					<div>
						<h3 class="text-lg font-bold">Medidor Digital</h3>
						<p class="text-blue-100 text-xs">Código Único</p>
					</div>
					<p-tag
						[value]="medidor.estado"
						[severity]="medidor.estado === 'ACTIVO' ? 'success' : 'danger'"
						[rounded]="true"
						class="uppercase text-xs"
					>
					</p-tag>
				</div>

				<div class="text-3xl font-extrabold mt-1 relative z-10 tracking-widest font-mono">
					{{ medidor.codigo }}
				</div>
			</div>

			<div class="p-4 space-y-3">
				<div class="flex justify-between items-center border-b border-gray-100 pb-2">
					<span class="text-gray-500 text-xs font-medium flex items-center gap-1">
						<i class="pi pi-map-marker text-blue-500"></i> Ubicación
					</span>
					<span class="text-gray-800 font-semibold text-sm">{{ medidor.nombre_barrio }}</span>
				</div>

				<div class="grid grid-cols-2 gap-2 py-1">
					<div>
						<span class="text-gray-400 text-[10px] uppercase font-bold block">Marca</span>
						<span class="text-gray-800 font-medium text-sm">{{ medidor.marca || 'Genérico' }}</span>
					</div>
					<div class="text-right">
						<span class="text-gray-400 text-[10px] uppercase font-bold block">Instalado</span>
						<span class="text-gray-800 font-medium text-sm">2025</span>
					</div>
				</div>

				<div class="bg-gray-50 rounded-lg p-3 text-center border border-gray-200">
					<p class="text-gray-400 text-[10px] uppercase font-bold mb-0">Lectura Inicial</p>
					<p class="text-2xl font-bold text-gray-800 leading-tight">
						{{ medidor.lectura_inicial }} <span class="text-sm text-gray-500 font-normal">m³</span>
					</p>
				</div>
			</div>
		</div>
	</div>

	<div class="lg:col-span-2">
		<div class="bg-white p-5 rounded-xl shadow-md border border-gray-100 h-full flex flex-col">
			<div class="flex justify-between items-center mb-4">
				<div>
					<h3 class="text-lg font-bold text-gray-800">Historial de Consumo</h3>
					<p class="text-xs text-gray-500">Últimos 6 meses</p>
				</div>
				<p-button icon="pi pi-chart-line" [rounded]="true" [text]="true" size="small" severity="secondary"></p-button>
			</div>

			<div class="flex-grow relative w-full h-[300px]">
				<p-chart type="line" [data]="chartData" [options]="chartOptions" height="100%" width="100%"></p-chart>
			</div>

			<div class="mt-3 p-2 bg-blue-50 text-blue-700 text-xs rounded-lg flex items-start gap-2">
				<i class="pi pi-info-circle mt-0.5"></i>
				<p>Promedio: <span class="font-bold">17 m³</span>. Límite tarifa básica: <strong>15 m³</strong>.</p>
			</div>
		</div>
	</div>
</div>

<div *ngIf="!isLoading && !medidor" class="text-center py-10">
	<div class="bg-gray-100 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-3">
		<i class="pi pi-exclamation-triangle text-2xl text-gray-400"></i>
	</div>
	<h3 class="text-lg font-bold text-gray-700">No encontramos información</h3>
	<p class="text-sm text-gray-500">Sin medidor asignado.</p>
</div>
